name: Update GitHub Stats

on:
  schedule:
    - cron: "0 0 * * *" # ë§¤ì¼ ìì •(UTC) ìë™ ì‹¤í–‰ -> í•œêµ­ì‹œê°„ ì˜¤ì „ 9ì‹œ
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      - name: Fetch GitHub Stats
        env:
          PAT_1: ${{ secrets.PAT_1 }}
        run: |
          # 1) GitHub Stats APIë¥¼ í˜¸ì¶œí•´ì„œ SVG íŒŒì¼ ë‚´ë ¤ë°›ê¸°
          curl -H "Authorization: Bearer $PAT_1" \
            "https://github-readme-stats.vercel.app/api?username=YenaLey&show_icons=true&hide=stars,contribs&hide_rank=true&count_private=true&include_all_commits=true" \
            -o stats.svg

          # 2) Top Langsë„ ë™ì¼í•˜ê²Œ
          curl -H "Authorization: Bearer $PAT_1" \
            "https://github-readme-stats.vercel.app/api/top-langs?username=YenaLey&layout=compact&count_private=true" \
            -o langs.svg

          # 3) README.md ë‚´ìš©ì„ ì¹˜í™˜í•˜ì—¬ stats.svg, langs.svg ì´ë¯¸ì§€ë¥¼ ì‚½ì…
          #   (<!--STATS_START--> ~ <!--STATS_END--> êµ¬ê°„ê³¼
          #    <!--LANGS_START--> ~ <!--LANGS_END--> êµ¬ê°„ì„ ëŒ€ì²´)
          sed -i '/<!--STATS_START-->/, /<!--STATS_END-->/ c\
          <!--STATS_START-->\n![](./stats.svg)\n<!--STATS_END-->' README.md

          sed -i '/<!--LANGS_START-->/, /<!--LANGS_END-->/ c\
          <!--LANGS_START-->\n![](./langs.svg)\n<!--LANGS_END-->' README.md

      - name: Commit and Push Changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add README.md stats.svg langs.svg
          # ë³€ê²½ì´ ì—†ìœ¼ë©´ ì»¤ë°‹ì„ ìƒëµí•˜ê³  ë„˜ì–´ê°€ê¸°
          git commit -m "ğŸ”„ Update GitHub Stats (auto)" || echo "No changes to commit"
          git push
