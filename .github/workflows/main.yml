name: Update GitHub Stats

on:
  schedule:
    - cron: "0 0 * * *" # ë§¤ì¼ ìì •(UTC) ìë™ ì‹¤í–‰ (í•œêµ­ì‹œê° ì˜¤ì „ 9ì‹œ)
  workflow_dispatch: # í•„ìš” ì‹œ Actions íƒ­ì—ì„œ ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      # 1) ì €ì¥ì†Œë¥¼ ì²´í¬ì•„ì›ƒ (ê¸°ë³¸ GITHUB_TOKEN ì‚¬ìš© X, PATìœ¼ë¡œ ì§ì ‘ pushí•  ì˜ˆì •ì´ë¯€ë¡œ)
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      # 2) stats.svg, langs.svg íŒŒì¼ì„ ìƒì„±í•˜ê³  README.md ë‚´ìš©ì„ ì¹˜í™˜
      - name: Fetch GitHub Stats
        env:
          PAT_1: ${{ secrets.PAT_1 }}
        run: |
          # (A) stats.svg ë‹¤ìš´ë¡œë“œ: Org ê¸°ì—¬/Private ê¸°ì—¬ í¬í•¨í•˜ë ¤ë©´ í† í° í—¤ë”ë¡œ
          curl -H "Authorization: Bearer $PAT_1" \
            "https://github-readme-stats.vercel.app/api?username=YenaLey&show_icons=true&hide=stars,contribs&hide_rank=true&count_private=true&include_all_commits=true" \
            -o stats.svg

          # (B) langs.svg ë‹¤ìš´ë¡œë“œ
          curl -H "Authorization: Bearer $PAT_1" \
            "https://github-readme-stats.vercel.app/api/top-langs?username=YenaLey&layout=compact&count_private=true" \
            -o langs.svg

          # (C) README.mdì˜ <!--STATS_START--> ~ <!--STATS_END--> êµ¬ê°„ì„ stats.svg ë¡œ ì¹˜í™˜
          sed -i '/<!--STATS_START-->/, /<!--STATS_END-->/ c\
          <!--STATS_START-->\n![](./stats.svg)\n<!--STATS_END-->' README.md

          # (D) README.mdì˜ <!--LANGS_START--> ~ <!--LANGS_END--> êµ¬ê°„ì„ langs.svg ë¡œ ì¹˜í™˜
          sed -i '/<!--LANGS_START-->/, /<!--LANGS_END-->/ c\
          <!--LANGS_START-->\n![](./langs.svg)\n<!--LANGS_END-->' README.md

      # 3) ë³€ê²½ì‚¬í•­ ì»¤ë°‹ & PAT ì‚¬ìš©í•´ í‘¸ì‹œ
      - name: Commit and Push Changes
        env:
          PAT_1: ${{ secrets.PAT_1 }} # ë³¸ì¸ì´ Secretsì— ì €ì¥í•œ Personal Access Token
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

          git add README.md stats.svg langs.svg
          git commit -m "ğŸ”„ Update GitHub Stats (auto)" || echo "No changes to commit"

          # x-access-token + PAT ìœ¼ë¡œ ì¸ì¦ í›„ main ë¸Œëœì¹˜ì— í‘¸ì‹œ
          git push "https://x-access-token:${PAT_1}@github.com/YenaLey/YenaLey.git" main
